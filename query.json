{
  'aggs': {
    'by_date': {
      'date_histogram': {
        'field': 'date',
        'interval': 'day',
        'format': 'yyyy-MM-dd'
      },
      'aggs': {
        'by_am_pm': {
          'terms': {
            'field': 'am_pm'
          },
          'aggs': {
            'by_category': {
              'terms': {
                'field': 'category'
              },
              'aggs': {
                'by_time': {
                  'terms': {
                    'field': 'time'
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
